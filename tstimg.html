<div class="modal fade" id="addRoomModal" tabindex="-1" aria-labelledby="addRoomModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success">
                <h1 class="modal-title fs-5" id="addRoomModalLabel">Add Room</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addRoomForm" action="" method="POST" enctype="multipart/form-data">
                    @csrf
                    <div class="form-group">
                        <label for="roomnumber">Room Number</label>
                        <input type="text" class="form-control" id="roomnumber" name="roomnumber" placeholder="Room Number" required>
                    </div>

                    <div class="form-group">
                        <label for="roomtype">Room Type</label>
                        <select class="form-control" name="category_id" id="roomtype" required>
                            <option value="" selected disabled>--select room type--</option>
                            @foreach ($categories as $category)
                                <option value="{{$category->id}}">{{$category->category}}</option>
                            @endforeach
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="bed">Bed</label>
                        <select class="form-control" name="bed" id="bed" required>
                            <option value="" selected disabled>--select bed--</option>
                            <option value="single bed">Single Bed</option>
                            <option value="double bed">Double Bed</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" id="description" name="description" placeholder="Description" rows="4" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="addImages">Images</label>
                        <input class="form-control" type="file" name="images[]" id="addImages" multiple>
                    </div>

                    <div id="add-image-preview" class="mb-3"></div>

                    <div class="d-flex justify-content-end mt-2">
                        <button type="submit" class="btn btn-success">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Arrays to keep track of selected files for both modals
    const selectedFilesAdd = [];
    const selectedFilesEdit = [];

    function setupImagePreview(inputId, previewId, selectedFilesArray) {
        document.getElementById(inputId).addEventListener('change', function(event) {
            const files = event.target.files;
            const fileArray = Array.from(files);

            // Add new files to the selectedFiles array
            fileArray.forEach(file => {
                selectedFilesArray.push(file);
            });

            updateImagePreview(previewId, selectedFilesArray);

            // Reset the file input so the same files can be selected again if needed
            document.getElementById(inputId).value = '';
        });
    }

    function updateImagePreview(previewId, selectedFilesArray) {
        const imagePreview = document.getElementById(previewId);
        imagePreview.innerHTML = '';

        selectedFilesArray.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const div = document.createElement('div');
                div.className = 'image-container';

                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '150px';

                const removeButton = document.createElement('span');
                removeButton.innerText = 'X';
                removeButton.className = 'remove-button';

                removeButton.addEventListener('click', function() {
                    div.remove();
                    selectedFilesArray.splice(index, 1);
                    updateImagePreview(previewId, selectedFilesArray);
                });

                div.appendChild(img);
                div.appendChild(removeButton);
                imagePreview.appendChild(div);
            }
            reader.readAsDataURL(file);
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Initialize image previews for both modals
        setupImagePreview('addImages', 'add-image-preview', selectedFilesAdd);
        setupImagePreview('editImages', 'edit-image-preview', selectedFilesEdit);

        // Handle form submissions
        document.getElementById('addRoomForm').addEventListener('submit', function(event) {
            const dt = new DataTransfer();

            // Append selected files to DataTransfer object
            selectedFilesAdd.forEach(file => dt.items.add(file));

            // Ensure the file input field is updated with the new DataTransfer files
            document.getElementById('addImages').files = dt.files;
        });

        document.getElementById('editRoomForm').addEventListener('submit', function(event) {
            const dt = new DataTransfer();

            // Append selected files to DataTransfer object
            selectedFilesEdit.forEach(file => dt.items.add(file));

            // Ensure the file input field is updated with the new DataTransfer files
            document.getElementById('editImages').files = dt.files;
        });

        // Populate fields in edit modal
        var editRoomModal = document.getElementById('editRoomModal');
        editRoomModal.addEventListener('show.bs.modal', function(event) {
            var button = event.relatedTarget;
            var roomId = button.getAttribute('data-room-id');
            var roomNumber = button.getAttribute('data-room-number');
            var roomCategory = button.getAttribute('data-room-category');
            var roomBed = button.getAttribute('data-room-bed');
            var roomDescription = button.getAttribute('data-room-description');

            var modal = this;
            modal.querySelector('#room_id').value = roomId;
            modal.querySelector('#editRoomNumber').value = roomNumber;
            modal.querySelector('#editRoomType').value = roomCategory;
            modal.querySelector('#editBed').value = roomBed;
            modal.querySelector('#editDescription').value = roomDescription;
        });
    });
</script>