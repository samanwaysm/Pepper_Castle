<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pepper Castle</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&amp;family=Work+Sans:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.min.css">
    <link rel='stylesheet' id='bootstrap-css' href='css/bootstrap/css/bootstrap.min.css' type='text/css' media='all' />
    <!-- Font Awesome Icons CSS -->
    <link rel='stylesheet' id='font-awesome' href='css/fontawesome/css/font-awesome.min.css' type='text/css'
        media='all' />
    <!-- Owl Carousel -->
    <link rel='stylesheet' id='owl-carousel' href='js/owl-carousel/owl.carousel.min.css' type='text/css' media='all' />
    <!-- Main CSS File -->
    <link rel='stylesheet' id='caverta-style-css' href='/css/style.css' type='text/css' media='all' />
    <!-- favicons -->
    <link rel='stylesheet' id='caverta-style-css' href='/css/cart.css' type='text/css' media='all' />
    <link rel="icon" href="/images/fav.png" sizes="32x32" />
    <link rel="icon" href="/images/icons/favicon-192x192.png" sizes="192x192" />
    <link rel="apple-touch-icon-precomposed" href="/images/icons/favicon-180x180.png" />

    <style>
        /* Breadcrumb */
        .breadcrumb {
            margin: 20px;
            font-size: 16px;
        }

        .breadcrumb a {
            text-decoration: none;
            color: #ff6600;
        }

        .breadcrumb span {
            color: #555;
        }

        /* Profile Container */
        .profile-container {
            display: flex;
            flex-wrap: wrap;
            max-width: 95%;
            margin: 40px auto;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        /* Sidebar */
        .profile-sidebar {
            width: 100%;
            max-width: 400px;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .profile-sidebar .profile-image {
            /* width: 120px; */
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 20px;
        }

        .profile-sidebar h2 {
            font-size: 22px;
            color: #333;
            margin-bottom: 20px;
        }

        .profile-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .profile-menu li {
            margin-bottom: 15px;
        }

        .profile-menu a {
            text-decoration: none;
            font-size: 18px;
            color: #555;
            display: block;
            padding: 10px;
            border-radius: 5px;
        }

        .profile-menu a:hover,
        .profile-menu .active {
            background-color: #ff6600;
            color: white;
        }

        /* Profile Details Section */
        .profile-details {

            flex-grow: 2;
            padding: 20px;
            width: 100%;
        }

        .profile-details h2 {
            font-size: 26px;
            color: #333;
            margin-bottom: 30px;
            font-weight: 500;
        }

        /* Table Styles */
        /* Info Container for the cards */

        /* Info Container for the cards */
        .info-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 100%;
            padding: 0 15px;
        }

        /* Individual card design */
        .info-card {
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #ddd;
            /* Simple border */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            /* Light shadow */
            overflow: hidden;
            padding: 10px 15px;
            /* Reduced padding for compactness */
            transition: box-shadow 0.3s ease;
            width: 100%;
            margin: 5px 0;
        }

        .info-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* Header styling for each card */
        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            /* Reduced margin for compact look */
        }

        .info-header .name {
            font-size: 16px;
            /* Slightly smaller font size */
            font-weight: 500;
            color: #333;
        }

        .info-header .email {
            font-size: 14px;
            color: #777;
        }

        /* Body section for addresses and other info */
        .info-body {
            margin-bottom: 8px;
            font-size: 13px;
            /* Reduced font size */
            color: #555;
        }

        .info-body p {
            margin: 3px 0;
            /* Tightened spacing */
        }

        /* Action section */
        .info-action {
            display: flex;
            justify-content: flex-end;
            gap: 6px;
            /* Smaller gap between buttons */
        }

        .action-btn,
        .delete-btn {
            background-color: #ff6600;
            color: white;
            border: none;
            padding: 6px 12px;
            /* Smaller buttons */
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.3s ease;
        }

        .action-btn:hover {
            background-color: #e65c00;
        }

        .delete-btn {
            background-color: #ff3333;
        }

        .delete-btn:hover {
            background-color: #cc0000;
        }

        .add-address-btn{
            margin-top: 10px;
            margin-bottom: 10px;
            margin-left: 20px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            color: #fff;
            background-color: #ff6600;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .info-container {
                padding: 0 10px;
            }

            .info-card {
                padding: 12px;
                margin: 8px 0;
            }

            .info-body p {
                font-size: 12px;
            }
        }

        @media (max-width: 768px) {
            .info-card {
                padding: 10px;
            }

            .info-header {
                font-size: 14px;
            }

            .info-body p {
                font-size: 12px;
            }

            .action-btn,
            .delete-btn {
                padding: 5px 10px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .info-container {
                padding: 0 10px;
            }

            .info-card {
                padding: 8px;
            }

            .info-header {
                font-size: 13px;
            }

            .info-body p {
                font-size: 12px;
            }

            .action-btn,
            .delete-btn {
                padding: 5px 10px;
                font-size: 11px;
            }
        }






        /* Responsive Design */
        @media (max-width: 600px) {
            .info-table {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .info-table {
                grid-template-columns: 1fr;
            }
        }


        /* Responsive Design */
        @media (max-width: 768px) {

            .tbl-stl {
                padding: 10px;
                font-size: 14px;
            }
        }


        @media (max-width: 1024px) {
            .profile-container {
                flex-direction: column;
            }

            .profile-details {
                padding: 20px;
                width: 100%;
            }

            .profile-sidebar {
                max-width: 100%;
                margin-bottom: 20px;
            }

            .breadcrumb {
                font-size: 14px;
                margin: 10px;
            }

            .info-table {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {
            .profile-container {
                flex-wrap: nowrap;
            }

            .profile-sidebar {
                max-width: 300px;
            }

            .profile-details {
                padding: 40px 20px;
            }

            .info-table {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 767px) {
            .profile-sidebar {
                width: 100%;
                margin-bottom: 20px;
            }

            .profile-details {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .breadcrumb {
                font-size: 14px;
                margin: 10px;
            }

            .profile-sidebar {
                padding: 20px;
            }

            .profile-details h2 {
                font-size: 22px;
            }

            .save-btn {
                padding: 10px 15px;
            }
        }
        .fa-user{
            color: #ff6600;
        }
    </style>

</head>

<body class="home">
    <div class="menu-mask"></div>
    <!-- MOBILE MENU HOLDER -->
    <div class="mobile-menu-holder">
        <div class="modal-menu-container">
            <div class="exit-mobile">
                <span class="icon-bar1"></span>
                <span class="icon-bar2"></span>
            </div>
            <!-- MOBILE MENU -->
            <ul class="menu-mobile">
                <li class="menu-item menu-item-has-children">
                    <a href="#">Home</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="about.html">About</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="testimonials.html">Testimonials</a>
                </li>
                <li class="menu-item menu-item-has-children current-menu-item">
                    <a href="our-menu.html">Our Menu</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="contact.html">Contact</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="#">Sign Up</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="#"><i class="fas fa-cart-plus"></i></a>
                </li>
            </ul>
            <!-- /MOBILE MENU -->
        </div>
        <!-- modal-menu-container -->
        <div class="menu-contact">
            <div class="mobile-btn">
                <a href="#" class="view-more">Order Now</a>
            </div>
            <ul class="mobile-contact">
                <li class="mobile-address">58 Ralph Ave<br />
                    New York, New York 1111
                </li>
                <li class="mobile-phone">+1 800 000 111</li>
                <li class="mobile-email"><a href="#" class="__cf_email__"
                        data-cfemail="01626e6f75606275416479606c716d642f626e6c">[email&#160;protected]</a></li>
            </ul>
            <ul class="social-media">
                <li><a class="social-facebook" href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
                <li><a class="social-instagram" href="https://www.instagram.com/pepper_castle_/?igshid=eddejyohhgwd"
                        target="_blank"><i class="fab fa-instagram"></i></a></li>
            </ul>
        </div>
        <!-- /menu-contact-->
    </div>
    <!-- /MOBILE MENU HOLDER -->
    <!-- HEADER -->
    <header id="header-1" class="headerHolder header-1 nav-fixed-top-cart">
        <div class="nav-button-holder">
            <button type="button" class="nav-button">
                <span class="icon-bar"></span>
            </button>
        </div>
        <!-- /nav-button-holder-->
        <!-- LOGO -->
        <div class="logo logo-1"><a href="index.html"><img class="img-fluid" src="/images/Pepper-Castle_White.png"
                    alt="Caverta" /></a></div>
        <!-- MENU -->
        <nav class="nav-holder nav-holder-1">
            <ul class="menu-nav menu-nav-1">
                <li class="menu-item menu-item-has-children">
                    <a href="/">Home</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="/about">About</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="/testimonials">Testimonials</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="/our-menu">Our Menu</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="/contact">Contact</a>
                </li>
            </ul>
        </nav>
        <!-- /MENU -->
        <div class="social-btn-top1">
            <% if(!isUserAuth){ %>
                <ul class="social-media social-media1 login-signup">
                    <li class="menu-item menu-item-has-children">
                        <!-- <a href="/signin">SignIn</a> -->
                    </li>
                </ul>
                <% }else{ %>
                    <ul class=" menu-nav menu-nav-1"></ul>
                    <li class="menu-item menu-item-has-children list-unstyled" style="margin-left: 50px;">
                        <a class="icon-link-white" href="#"><i class="fas fa-user"></i></a>
                    </li>
                    <li class="menu-item menu-item-has-children list-unstyled current-menu-item"
                        style="margin-left: 30px;margin-right: 30px;">
                        <a class="icon-link-white" href="/cart"><i class="fas fa-cart-plus" id="cartIcon"></i></a>
                    </li>
                    </ul>
                    <% } %>
                        <% if(!isUserAuth){ %>
                            <div class="btn-header btn-header1 profile-cart-btns">
                                <a href="/signin" class="view-more">Order Now</a>
                            </div>
                            <% }else{ %>
                                <div class="btn-header btn-header1 profile-cart-btns">
                                    <a href="/our-menu" class="view-more">Order Now</a>
                                </div>
                                <% } %>
        </div>
        <!-- /social-btn-top1 -->
    </header>
    <!-- WRAP CONTENT -->
    <div class="breadcrumb">
        <a href="/">Home</a> &gt; <span>My Account</span>
    </div>

    <div class="profile-container">
        <div class="profile-sidebar">
            <!-- <img src="path_to_profile_image" alt="Profile" class="profile-image" /> -->
            <h2 class="profile-name"><%= username %></h2>
            <ul class="profile-menu">
                <li><a href="/profile">My Account</a></li>
                <li><a href="/manage-address" class="active">Manage Address</a></li>
                <li><a href="/order-history">Order History</a></li>
                <li><a href="/change-password">Change Password</a></li>
                <li><a href="/api/logout">Logout</a></li>
            </ul>
        </div>
        <!-- <div class="info-container">
            <div class="info-card">
                <div class="info-header">
                    <h3>Sam</h3>
                    <p class="email">samanwaysm@gmail.com</p>
                </div>
                <div class="info-body">
                    <p><strong>Phone:</strong> 99615764</p>
                    <p><strong>Street:</strong> Pathayakunnu</p>
                    <p><strong>Block/Apartment:</strong> Sam house</p>
                    <p><strong>Floor / Unit:</strong> 0</p>
                    <p><strong>Postal Code:</strong> 670691</p>
                </div>
                <div class="info-action">
                    <button class="action-btn">Edit</button>
                    <button class="delete-btn">Delete</button>
                </div>
            </div> -->
            <div class="profile-details">
                <button class="add-address-btn">Add Address</button>
                <div id="addressList" class="info-container">
            </div>
            </div>
        </div>

    </div>

    <!-- /WRAP CONTENT -->
    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-widgets">
                <div class="row">
                    <!-- FOOTER COLUMN 1 -->
                    <div class="col-md-4">
                        <div class="foo-block">
                            <div id="text-2" class="widget widget-footer widget_text">
                                <div class="textwidget">
                                    <p><img class="size-full wp-image-665" src="/images/Pepper-Castle_White.png" alt=""
                                            width="250" height="51"></p>
                                    <p>We offer such food connoisseurs the very best of North Indian cuisine that is
                                        healthy, tasty, and free from additives.</p>
                                </div>
                            </div>
                        </div>
                        <!--foo-block-->
                    </div>
                    <!--col-md-3-->
                    <!-- FOOTER COLUMN 2 -->
                    <div class="col-md-3">
                        <div class="foo-block">
                            <div id="text-3" class="widget widget-footer widget_text">
                                <h5 class="widgettitle"><span>Address</span></h5>
                                <div class="textwidget">
                                    <p>33 Lorong liput<br> 277744 Singapore
                                    </p>
                                    <p style="white-space: nowrap;"><i class="fas fa-phone-alt"></i>+65 97440747<br>
                                        <i class="fas fa-envelope"></i><a href="#">peppercastle@hotmail.com</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!--foo-block-->
                    </div>
                    <!--col-md-3-->

                    <div class="col-md-3">
                        <div class="foo-block foo-last">
                            <div id="text-5" class="widget widget-footer widget_text">
                                <h5 class="widgettitle"><span>Quick Links</span></h5>
                                <div class="textwidget ftr-menu">
                                    <ul>
                                        <li><a href="index.html">-Home</a></li>
                                        <li><a href="about.html">-About</a></li>
                                        <li><a href="testimonials.html">-Testimonials</a></li>
                                        <li><a href="#">-Our Menu</a></li>
                                        <li><a href="contact.html">-Contact</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!--foo-block-->
                    </div>
                    <!-- FOOTER COLUMN 3 -->
                    <div class="col-md-2">
                        <div class="foo-block">
                            <div id="text-4" class="widget widget-footer widget_text">
                                <h5 class="widgettitle"><span>Hours</span></h5>
                                <div class="textwidget">
                                    <p style="white-space: nowrap;">Monday – Sunday<br>
                                        11:00 AM - 11:00 PM
                                    </p>
                                </div>
                                <ul class="footer-social">
                                    <li><a class="social-facebook" href="#" target="_blank"><i
                                                class="fab fa-facebook-f"></i></a></li>
                                    <li><a class="social-instagram"
                                            href="https://www.instagram.com/pepper_castle_/?igshid=eddejyohhgwd"
                                            target="_blank"><i class="fab fa-instagram"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <!--foo-block-->
                    </div>
                    <!--col-md-3-->
                    <!-- FOOTER COLUMN 4 -->

                    <!--col-md-3-->
                </div>
                <!--row-->
            </div>
            <!-- footer-widgets -->
            <div class="copyright">
                <!-- COPYRIGHT -->
                <div class="footer-copy">
                    <p>© 2023 - Pepper Castle. All Rights Reserved.</p>
                </div>
                <!-- SOCIAL ICONS -->

            </div>
            <!--copyright-->
        </div>
        <!--container-->
    </footer>
    <!-- /FOOTER -->
    <div class="scrollup">
        <a class="scrolltop" href="#">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>
    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            updateCartCount();
        });

        function updateCartCount() {
            const userId = `<%= userId %>`;  // Make sure userId is defined here
            if (!userId) {
                console.error("userId is not defined!");
                return;
            }

            $.ajax({
                url: '/api/itemCount',
                method: 'GET',
                data: { userId: userId },
                success: function (response) {
                    console.log("Cart Count Response:", response);
                    cartCountDisplay(response.cartItemCount);  // Pass the cart item count directly
                },
                error: function () {
                    console.error("Error fetching cart count");
                }
            });
        }

        function cartCountDisplay(cartItemCount) {
            const cartIcon = document.getElementById('cartIcon');

            // Remove any existing counter to avoid duplication
            const existingCounter = cartIcon.querySelector('span');
            if (existingCounter) {
                cartIcon.removeChild(existingCounter);
            }

            // Create a new span element for the cart count
            const counter = document.createElement('span');
            counter.style.position = 'absolute';
            counter.style.borderRadius = '50%';
            counter.style.backgroundColor = 'var(--headings-color)';
            counter.style.width = '14px';
            counter.style.height = '14px';
            counter.style.top = '20px';
            // counter.style.right = '0'; 
            counter.style.textAlign = 'center';
            counter.style.lineHeight = '15px';
            counter.style.fontSize = '10px';
            counter.style.color = '#fff';
            counter.textContent = cartItemCount;  // Use the count returned from the server

            // Append the counter to the cart icon
            cartIcon.appendChild(counter);
        }


        document.addEventListener("DOMContentLoaded", fetchAddresses);

        function fetchAddresses() {
            const userId = `<%= userId %>`;
            const addressList = document.getElementById("addressList");
            addressList.innerHTML = 'Loading...';

            fetch(`/api/showAddressManagement?userId=${userId}`)
                .then(response => response.json())
                .then(data => {
                    addressList.innerHTML = '';
                    if (data.length === 0) {
                        addressList.innerHTML = 'No addresses found.';
                    } else {
                        console.log(data);
                        
                        data.forEach((address) => {
                            addressList.innerHTML += `
                        <div class="info-card">
                            <div class="info-header">
                                <h5>${address.username || 'Sam'}</h5>
                            </div>
                            <div class="info-body">
                                <p><strong>Phone:</strong> ${address.phone}</p>
                                <p><strong>Street:</strong> ${address.street || 'Pathayakunnu'}</p>
                                <p><strong>Block/Apartment:</strong> ${address.apartment || 'Sam house'}</p>
                                <p><strong>Floor / Unit:</strong> ${address.unit || '0'}</p>
                                <p><strong>Postal Code:</strong> ${address.postalCode || '670691'}</p>
                            </div>
                            <div class="info-action">
                                <button class="action-btn" onclick="editAddress('${address._id}')">Edit</button>
                                <button class="delete-btn" onclick="deleteAddress('${address._id}')">Delete</button>
                            </div>
                        </div>
                    `;
                        });
                    }
                })
                .catch(error => console.error('Error fetching addresses:', error));
        }

    </script>

    <!-- Removed redundant jQuery script -->
    <!-- <script src='js/jquery.js'></script> -->
    <script src='js/jquery-migrate.min.js'></script>
    <script src='css/bootstrap/js/popper.min.js'></script>
    <script src='css/bootstrap/js/bootstrap.min.js'></script>
    <script src='js/jquery.easing.min.js'></script>
    <script src='js/jquery.fitvids.js'></script>
    <script src='js/owl-carousel/owl.carousel.min.js'></script>
    <script src='js/jquery.magnific-popup.min.js'></script>
    <!-- MAIN JS -->
    <script src='js/init.js'></script>
    <!-- CONTACT FORM JS -->
    <script src='js/jquery.form.min.js'></script>
    <script src='js/contactform-home.js'></script>

</body>

</html>