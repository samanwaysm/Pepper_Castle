<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pepper Castle</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&amp;family=Work+Sans:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.min.css">
    <link rel='stylesheet' id='bootstrap-css' href='css/bootstrap/css/bootstrap.min.css' type='text/css' media='all' />
    <!-- Font Awesome Icons CSS -->
    <link rel='stylesheet' id='font-awesome' href='css/fontawesome/css/font-awesome.min.css' type='text/css'
        media='all' />
    <!-- Owl Carousel -->
    <link rel='stylesheet' id='owl-carousel' href='js/owl-carousel/owl.carousel.min.css' type='text/css' media='all' />
    <!-- Main CSS File -->
    <link rel='stylesheet' id='caverta-style-css' href='/css/style.css' type='text/css' media='all' />
    <!-- favicons -->
    <link rel='stylesheet' id='caverta-style-css' href='/css/cart.css' type='text/css' media='all' />
    <link rel="icon" href="/images/fav.png" sizes="32x32" />
    <link rel="icon" href="/images/icons/favicon-192x192.png" sizes="192x192" />
    <link rel="apple-touch-icon-precomposed" href="/images/icons/favicon-180x180.png" />

    <style>
        /* Breadcrumb */
        .breadcrumb {
            margin: 20px;
            font-size: 16px;
        }

        .breadcrumb a {
            text-decoration: none;
            color: #ff6600;
        }

        .breadcrumb span {
            color: #555;
        }

        /* Profile Container */
        .profile-container {
            display: flex;
            flex-wrap: wrap;
            max-width: 95%;
            margin: 40px auto;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        /* Sidebar */
        .profile-sidebar {
            width: 100%;
            max-width: 400px;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .profile-sidebar .profile-image {
            /* width: 120px; */
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 20px;
        }

        .profile-sidebar h2 {
            font-size: 22px;
            color: #333;
            margin-bottom: 20px;
        }

        .profile-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .profile-menu li {
            margin-bottom: 15px;
        }

        .profile-menu a {
            text-decoration: none;
            font-size: 18px;
            color: #555;
            display: block;
            padding: 10px;
            border-radius: 5px;
        }

        .profile-menu a:hover,
        .profile-menu .active {
            background-color: #ff6600;
            color: white;
        }

        /* Profile Details Section */
        .profile-details {

            flex-grow: 2;
            padding: 20px;
            width: 100%;
        }

        .profile-details h2 {
            font-size: 26px;
            color: #333;
            margin-bottom: 30px;
            font-weight: 500;
        }

        /* Table Styles */
        /* Info Container for the cards */

        /* Info Container for the cards */
        .info-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 100%;
            padding: 0 15px;
        }

        /* Individual card design */
        .info-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #ffffff;
    border-radius: 8px;
    border: 1px solid #ddd;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    padding: 10px;
    transition: box-shadow 0.3s ease;
    width: 100%;
    margin: 5px 0;
}

.info-card:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Header section with fixed width */
.info-header {
    display: flex;
    flex-direction: column;
    justify-content: center;
    width: 300px; /* Fixed width for desktop view */
}

.info-header .name {
    font-size: 18px;
    font-weight: 500;
    color: #333;
}

.info-header .email {
    font-size: 14px;
    color: #777;
}

/* Body section with fixed width for details */
.info-body {
    display: flex;
    flex-direction: column;
    justify-content: center;
    width: 400px; /* Fixed width for body */
    font-size: 14px;
    color: #555;
}

.info-body p {
    margin: 5px 0;
}

/* Action buttons aligned to the right with fixed width */
.info-action {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 10px;
    width: 150px; /* Fixed width for action buttons */
}

.action-btn,
.delete-btn {
    background-color: #ff6600;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s ease;
}

.action-btn:hover {
    background-color: #e65c00;
}

.delete-btn {
    background-color: #ff3333;
}

.delete-btn:hover {
    background-color: #cc0000;
}

.add-address-btn {
    margin-top: 10px;
    margin-bottom: 10px;
    margin-left: 20px;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    color: #fff;
    background-color: #ff6600;
}

/* Responsive Design for Tablets */
@media (max-width: 1024px) {
    .info-header {
        width: 250px; /* Adjusted width */
    }

    .info-body {
        width: 300px; /* Adjusted width */
    }

    .info-action {
        width: 120px; /* Adjusted width */
    }
}

/* Responsive Design for Mobile */
@media (max-width: 768px) {
    .info-card {
        flex-direction: column; /* Stack elements in a column */
        align-items: flex-start;
    }

    .info-header, .info-body, .info-action {
        width: 100%; /* Full width for all sections on mobile */
    }

    .info-header {
        margin-bottom: 10px;
    }

    .info-action {
        justify-content: flex-start;
    }

    .action-btn,
    .delete-btn {
        font-size: 12px; /* Smaller buttons for mobile */
        padding: 6px 10px;
    }
}

/* Mobile view - All items 1/1 */
@media (max-width: 480px) {
    .info-body {
        font-size: 12px;
    }

    .info-header .name {
        font-size: 16px;
    }

    .info-header .email {
        font-size: 12px;
    }

    .action-btn,
    .delete-btn {
        font-size: 11px;
        padding: 5px 8px;
    }
}






        /* Responsive Design */
        @media (max-width: 600px) {
            .info-table {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .info-table {
                grid-template-columns: 1fr;
            }
        }


        /* Responsive Design */
        @media (max-width: 768px) {

            .tbl-stl {
                padding: 10px;
                font-size: 14px;
            }
        }


        @media (max-width: 1024px) {
            .profile-container {
                flex-direction: column;
            }

            .profile-details {
                padding: 20px;
                width: 100%;
            }

            .profile-sidebar {
                max-width: 100%;
                margin-bottom: 20px;
            }

            .breadcrumb {
                font-size: 14px;
                margin: 10px;
            }

            .info-table {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {
            .profile-container {
                flex-wrap: nowrap;
            }

            .profile-sidebar {
                max-width: 300px;
            }

            .profile-details {
                padding: 40px 20px;
            }

            .info-table {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 767px) {
            .profile-sidebar {
                width: 100%;
                margin-bottom: 20px;
            }

            .profile-details {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .breadcrumb {
                font-size: 14px;
                margin: 10px;
            }

            .profile-sidebar {
                padding: 20px;
            }

            .profile-details h2 {
                font-size: 22px;
            }

            .save-btn {
                padding: 10px 15px;
            }
        }

        .fa-user {
            color: #ff6600;
        }



        .default-address {
            border: 2px solid rgb(255, 170, 43);
            background-color: rgb(255, 247, 234);
        }


        /* Modal Styles */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1000;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgba(0, 0, 0, 0.5);
            /* Black w/ opacity */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            /* Centered */
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            /* Width of modal */
            max-width: 600px;
            /* Max width */
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            /* To position the close button */
        }

        .close {
            color: #aaa;
            position: absolute;
            /* Absolute positioning */
            top: 15px;
            /* Position from top */
            right: 15px;
            /* Position from right */
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        h2 {
            margin-top: 0;
        }

        /* Form Styles */
        .modal-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* Two columns for desktop */
            gap: 15px;
            /* Space between inputs */
            margin-top: 20px;
            /* Space above the form */
        }

        .form-row {
            display: flex;
            flex-direction: column;
        }

        /* Responsive Styles */
        @media (max-width: 600px) {
            .modal-form {
                grid-template-columns: 1fr;
                /* One column for mobile */
            }
        }

        label {
            margin-bottom: 5px;
        }

        input[type="text"] {
            width: 100%;
            /* Full width */
            padding: 10px;
            margin-bottom: 4px;
            /* Space below each input */
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        input[type="checkbox"] {
            width: 100%;
            display: flex;
            /* Full width */
            /* padding: 10px;
            margin-bottom: 4px; */
            /* Space below each input */
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        /* Button Styles */
        button {
            background-color: #ff6600;
            /* Green */
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            margin-top: 10px;
            /* Space above button */
        }

        button:hover {
            background-color: #ff6600;
            /* Darker green */
        }

        .add-def-lbl {
            display: flex;
            margin-top: 15px;
            margin-bottom: none;
        }
    </style>

</head>

<body class="home">
    <div class="menu-mask"></div>
    <!-- MOBILE MENU HOLDER -->
    <div class="mobile-menu-holder">
        <div class="modal-menu-container">
            <div class="exit-mobile">
                <span class="icon-bar1"></span>
                <span class="icon-bar2"></span>
            </div>
            <!-- MOBILE MENU -->
            <ul class="menu-mobile">
                <li class="menu-item menu-item-has-children">
                    <a href="#">Home</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="about.html">About</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="testimonials.html">Testimonials</a>
                </li>
                <li class="menu-item menu-item-has-children current-menu-item">
                    <a href="our-menu.html">Our Menu</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="contact.html">Contact</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="#">Sign Up</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="#"><i class="fas fa-cart-plus"></i></a>
                </li>
            </ul>
            <!-- /MOBILE MENU -->
        </div>
        <!-- modal-menu-container -->
        <div class="menu-contact">
            <div class="mobile-btn">
                <a href="#" class="view-more">Order Now</a>
            </div>
            <ul class="mobile-contact">
                <li class="mobile-address">58 Ralph Ave<br />
                    New York, New York 1111
                </li>
                <li class="mobile-phone">+1 800 000 111</li>
                <li class="mobile-email"><a href="#" class="__cf_email__"
                        data-cfemail="01626e6f75606275416479606c716d642f626e6c">[email&#160;protected]</a></li>
            </ul>
            <ul class="social-media">
                <li><a class="social-facebook" href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
                <li><a class="social-instagram" href="https://www.instagram.com/pepper_castle_/?igshid=eddejyohhgwd"
                        target="_blank"><i class="fab fa-instagram"></i></a></li>
            </ul>
        </div>
        <!-- /menu-contact-->
    </div>
    <!-- /MOBILE MENU HOLDER -->
    <!-- HEADER -->
    <header id="header-1" class="headerHolder header-1 nav-fixed-top-cart">
        <div class="nav-button-holder">
            <button type="button" class="nav-button">
                <span class="icon-bar"></span>
            </button>
        </div>
        <!-- /nav-button-holder-->
        <!-- LOGO -->
        <div class="logo logo-1"><a href="index.html"><img class="img-fluid" src="/images/Pepper-Castle_White.png"
                    alt="Caverta" /></a></div>
        <!-- MENU -->
        <nav class="nav-holder nav-holder-1">
            <ul class="menu-nav menu-nav-1">
                <li class="menu-item menu-item-has-children">
                    <a href="/">Home</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="/about">About</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="/testimonials">Testimonials</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="/our-menu">Our Menu</a>
                </li>
                <li class="menu-item menu-item-has-children">
                    <a href="/contact">Contact</a>
                </li>
            </ul>
        </nav>
        <!-- /MENU -->
        <div class="social-btn-top1">
            <% if(!isUserAuth){ %>
                <ul class="social-media social-media1 login-signup">
                    <li class="menu-item menu-item-has-children">
                        <!-- <a href="/signin">SignIn</a> -->
                    </li>
                </ul>
                <% }else{ %>
                    <ul class=" menu-nav menu-nav-1"></ul>
                    <li class="menu-item menu-item-has-children list-unstyled" style="margin-left: 50px;">
                        <a class="icon-link-white" href="/profile"><i class="fas fa-user"></i></a>
                    </li>
                    <li class="menu-item menu-item-has-children list-unstyled current-menu-item"
                        style="margin-left: 30px;margin-right: 30px;">
                        <a class="icon-link-white" href="/cart"><i class="fas fa-cart-plus" id="cartIcon"></i></a>
                    </li>
                    </ul>
                    <% } %>
                        <% if(!isUserAuth){ %>
                            <div class="btn-header btn-header1 profile-cart-btns">
                                <a href="/signin" class="view-more">Order Now</a>
                            </div>
                            <% }else{ %>
                                <div class="btn-header btn-header1 profile-cart-btns">
                                    <a href="/our-menu" class="view-more">Order Now</a>
                                </div>
                                <% } %>
        </div>
        <!-- /social-btn-top1 -->
    </header>
    <!-- WRAP CONTENT -->
    <div class="breadcrumb">
        <a href="/">Home</a> &gt; <span>My Account</span>
    </div>

    <div class="profile-container">
        <div class="profile-sidebar">
            <!-- <img src="path_to_profile_image" alt="Profile" class="profile-image" /> -->
            <h2 class="profile-name">
                <%= username %>
            </h2>
            <ul class="profile-menu">
                <li><a href="/profile">My Account</a></li>
                <li><a href="/manage-address" class="active">Manage Address</a></li>
                <li><a href="/orders-list">Your Orders</a></li>
                <li><a href="/change-password">Change Password</a></li>
                <li><a href="/api/logout">Logout</a></li>
            </ul>
        </div>
        <div class="profile-details">
            <!-- <button class="add-address-btn">Add Address</button> -->
            <button class="add-address-btn" onclick="showAddAddressModal()">Add Address</button>
            <div id="addressList" class="info-container">
            </div>
        </div>
    </div>
    </div>

    <!-- Add Address Modal -->
    <div id="addAddressModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addAddressModal')">&times;</span>
            <h4>Add Address</h4>
            <form id="addAddressForm" class="modal-form">
                <div class="form-row">
                    <label for="addUsername">Username</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-row">
                    <label for="addPhone">Phone</label>
                    <input type="text" id="phone" required>
                </div>
                <div class="form-row">
                    <label for="addStreet">Street</label>
                    <input type="text" id="street" required>
                </div>
                <div class="form-row">
                    <label for="addApartment">Block</label>
                    <input type="text" id="block">
                </div>
                <div class="form-row">
                    <label for="addUnit">Unit</label>
                    <input type="text" id="unitnum">
                </div>
                <div class="form-row">
                    <label for="addPostalCode">Postal Code</label>
                    <input type="text" id="postal" required>
                </div>
                <div class="form-row">
                    <label class="add-def-lbl" for="addIsDefault">Set as Default</label>
                    <input type="checkbox" id="addIsDefault">
                </div>

                <button type="submit">Add Address</button>
            </form>
        </div>
    </div>

    <!-- Edit Address Modal -->
    <div id="editAddressModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editAddressModal')">&times;</span>
            <h4>Edit Address</h4>
            <form id="editAddressForm" class="modal-form">
                <input type="hidden" id="editAddressId">
                <div class="form-row">
                    <label for="editUsername">Username</label>
                    <input type="text" id="editUsername" required>
                </div>
                <div class="form-row">
                    <label for="editPhone">Phone</label>
                    <input type="text" id="editPhone" required>
                </div>
                <div class="form-row">
                    <label for="editStreet">Street</label>
                    <input type="text" id="editStreet" required>
                </div>
                <div class="form-row">
                    <label for="editApartment">Block</label>
                    <input type="text" id="editBlock">
                </div>
                <div class="form-row">
                    <label for="editUnit">Unit</label>
                    <input type="text" id="editUnitNum">
                </div>
                <div class="form-row">
                    <label for="editPostalCode">Postal Code</label>
                    <input type="text" id="editPostal" required>
                </div>
                <!-- <div class="form-row">
                    <label for="editIsDefault">Set as Default</label>
                    <input type="checkbox" id="editIsDefault">
                </div> -->

                <button type="submit">Save Changes</button>
            </form>
        </div>
    </div>


    <!-- <div class="info-container">
            <div class="info-card">
                <div class="info-header">
                    <h3>Sam</h3>
                    <p class="email">samanwaysm@gmail.com</p>
                </div>
                <div class="info-body">
                    <p><strong>Phone:</strong> 99615764</p>
                    <p><strong>Street:</strong> Pathayakunnu</p>
                    <p><strong>Block/Apartment:</strong> Sam house</p>
                    <p><strong>Floor / Unit:</strong> 0</p>
                    <p><strong>Postal Code:</strong> 670691</p>
                </div>
                <div class="info-action">
                    <button class="action-btn">Edit</button>
                    <button class="delete-btn">Delete</button>
                </div>
            </div> -->


    <!-- /WRAP CONTENT -->
    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-widgets">
                <div class="row">
                    <!-- FOOTER COLUMN 1 -->
                    <div class="col-md-4">
                        <div class="foo-block">
                            <div id="text-2" class="widget widget-footer widget_text">
                                <div class="textwidget">
                                    <p><img class="size-full wp-image-665" src="/images/Pepper-Castle_White.png" alt=""
                                            width="250" height="51"></p>
                                    <p>We offer such food connoisseurs the very best of North Indian cuisine that is
                                        healthy, tasty, and free from additives.</p>
                                </div>
                            </div>
                        </div>
                        <!--foo-block-->
                    </div>
                    <!--col-md-3-->
                    <!-- FOOTER COLUMN 2 -->
                    <div class="col-md-3">
                        <div class="foo-block">
                            <div id="text-3" class="widget widget-footer widget_text">
                                <h5 class="widgettitle"><span>Address</span></h5>
                                <div class="textwidget">
                                    <p>33 Lorong liput<br> 277744 Singapore
                                    </p>
                                    <p style="white-space: nowrap;"><i class="fas fa-phone-alt"></i>+65 97440747<br>
                                        <i class="fas fa-envelope"></i><a href="#">peppercastle@hotmail.com</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!--foo-block-->
                    </div>
                    <!--col-md-3-->

                    <div class="col-md-3">
                        <div class="foo-block foo-last">
                            <div id="text-5" class="widget widget-footer widget_text">
                                <h5 class="widgettitle"><span>Quick Links</span></h5>
                                <div class="textwidget ftr-menu">
                                    <ul>
                                        <li><a href="index.html">-Home</a></li>
                                        <li><a href="about.html">-About</a></li>
                                        <li><a href="testimonials.html">-Testimonials</a></li>
                                        <li><a href="/our-menu">-Our Menu</a></li>
                                        <li><a href="contact.html">-Contact</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!--foo-block-->
                    </div>
                    <!-- FOOTER COLUMN 3 -->
                    <div class="col-md-2">
                        <div class="foo-block">
                            <div id="text-4" class="widget widget-footer widget_text">
                                <h5 class="widgettitle"><span>Hours</span></h5>
                                <div class="textwidget">
                                    <p style="white-space: nowrap;">Monday – Sunday<br>
                                        11:00 AM - 11:00 PM
                                    </p>
                                </div>
                                <ul class="footer-social">
                                    <li><a class="social-facebook" href="#" target="_blank"><i
                                                class="fab fa-facebook-f"></i></a></li>
                                    <li><a class="social-instagram"
                                            href="https://www.instagram.com/pepper_castle_/?igshid=eddejyohhgwd"
                                            target="_blank"><i class="fab fa-instagram"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <!--foo-block-->
                    </div>
                    <!--col-md-3-->
                    <!-- FOOTER COLUMN 4 -->

                    <!--col-md-3-->
                </div>
                <!--row-->
            </div>
            <!-- footer-widgets -->
            <div class="copyright">
                <!-- COPYRIGHT -->
                <div class="footer-copy">
                    <p>© 2023 - Pepper Castle. All Rights Reserved.</p>
                </div>
                <!-- SOCIAL ICONS -->

            </div>
            <!--copyright-->
        </div>
        <!--container-->
    </footer>
    <!-- /FOOTER -->
    <div class="scrollup">
        <a class="scrolltop" href="#">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>
    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const userId = `<%= userId %>`;
        $(document).ready(function () {
            updateCartCount();
        });

        function updateCartCount() {
            const userId = `<%= userId %>`;  // Make sure userId is defined here
            if (!userId) {
                console.error("userId is not defined!");
                return;
            }

            $.ajax({
                url: '/api/itemCount',
                method: 'GET',
                data: { userId: userId },
                success: function (response) {
                    console.log("Cart Count Response:", response);
                    cartCountDisplay(response.cartItemCount);  // Pass the cart item count directly
                },
                error: function () {
                    console.error("Error fetching cart count");
                }
            });
        }

        function cartCountDisplay(cartItemCount) {
            const cartIcon = document.getElementById('cartIcon');

            // Remove any existing counter to avoid duplication
            const existingCounter = cartIcon.querySelector('span');
            if (existingCounter) {
                cartIcon.removeChild(existingCounter);
            }

            // Create a new span element for the cart count
            const counter = document.createElement('span');
            counter.style.position = 'absolute';
            counter.style.borderRadius = '50%';
            counter.style.backgroundColor = 'var(--headings-color)';
            counter.style.width = '14px';
            counter.style.height = '14px';
            counter.style.top = '20px';
            // counter.style.right = '0'; 
            counter.style.textAlign = 'center';
            counter.style.lineHeight = '15px';
            counter.style.fontSize = '10px';
            counter.style.color = '#fff';
            counter.textContent = cartItemCount;  // Use the count returned from the server

            // Append the counter to the cart icon
            cartIcon.appendChild(counter);
        }


        document.addEventListener("DOMContentLoaded", fetchAddresses);

        function fetchAddresses() {
            const userId = `<%= userId %>`;
            const addressList = document.getElementById("addressList");
            addressList.innerHTML = 'Loading...';

            $.ajax({
                url: `/api/showAddressManagement`,
                type: 'GET',
                data: { userId },
                success: function (data) {
                    addressList.innerHTML = '';
                    if (data.length === 0) {
                        addressList.innerHTML = 'No addresses found.';
                    } else {
                        data.forEach((address, index) => {
                            const isDefault = address.isDefault ? 'default-address' : '';
                            addressList.innerHTML += `
                        <div class="info-card ${isDefault}" data-index="${index}">
                            <div class="info-header">
                                <h6>${address.username}</h6>
                            </div>
                            <div class="info-body">
                                <p><strong>Phone:</strong> ${address.phone}</p>
                                <p><strong>Street:</strong> ${address.street}</p>
                                <p><strong>Block/Apartment:</strong> ${address.block}</p>
                                <p><strong>Floor / Unit:</strong> ${address.unitnum}</p>
                                <p><strong>Postal Code:</strong> ${address.postal}</p>
                            </div>
                            <div class="info-action">
                                <button class="action-btn" onclick="editAddress(${index}, '${address._id}', '${address.username}', '${address.phone}', '${address.street}', '${address.block}', '${address.unitnum}', '${address.postal}')">Edit</button>
                                <button class="delete-btn" onclick="deleteAddress(${index}, '${address._id}')">Delete</button>
                            </div>
                        </div>
                    `;
                        });
                    }
                },
                error: function (error) {
                    console.error('Error fetching addresses:', error);
                }
            });
        }

        function deleteAddress(index, id) {
            const userId = `<%= userId %>`;
            if (confirm('Are you sure you want to delete this address?')) {
                $.ajax({
                    url: `/api/deleteAddress?userId=${userId}`,
                    type: 'DELETE',
                    data: { addressId: id },
                    success: function (result) {
                        alert(result.message || 'Address deleted successfully');
                        document.querySelector(`[data-index="${index}"]`).remove();
                    },
                    error: function (error) {
                        console.error('Error deleting address:', error);
                    }
                });
            }
        }

        function editAddress(index, id, username, phone, street, block, unitnum, postal) {
            const modal = document.getElementById('editAddressModal');
            modal.style.display = 'block';

            // Fill in the modal form with existing address data
            document.getElementById('editAddressId').value = id;
            document.getElementById('editUsername').value = username || '';
            document.getElementById('editPhone').value = phone || '';
            document.getElementById('editStreet').value = street || '';
            document.getElementById('editBlock').value = block || '';
            document.getElementById('editUnitNum').value = unitnum || '';
            document.getElementById('editPostal').value = postal || '';

            // Close modal
            document.querySelector('.close').onclick = () => {
                modal.style.display = 'none';
            };

            // Handle form submission for editing address
            document.getElementById('editAddressForm').onsubmit = function (event) {
                // event.preventDefault();

                const updatedData = {
                    addressId: document.getElementById('editAddressId').value,
                    username: document.getElementById('editUsername').value,
                    phone: document.getElementById('editPhone').value,
                    street: document.getElementById('editStreet').value,
                    block: document.getElementById('editBlock').value,
                    unitnum: document.getElementById('editUnitNum').value,
                    postal: document.getElementById('editPostal').value,
                };

                const addressId = updatedData.addressId

                $.ajax({
                    url: `/api/updateAddress?userId=${userId}`,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ addressId, updatedData }),
                    success: function (result) {
                        alert(result.message || 'Address updated successfully');
                        modal.style.display = 'none';
                        fetchAddresses();  // Refresh the address list after the update
                    },
                    error: function (error) {
                        console.error('Error updating address:', error);
                    }
                });
            };
        }

        function showAddAddressModal() {

            const modal = document.getElementById('addAddressModal');
            modal.style.display = 'block';

            // Close modal
            document.querySelector('.close').onclick = () => {
                modal.style.display = 'none';
            };

            // Handle form submission for adding new address
            document.getElementById('addAddressForm').onsubmit = function (event) {
                event.preventDefault();

                const newAddressData = {
                    username: document.getElementById('username').value,
                    phone: document.getElementById('phone').value,
                    street: document.getElementById('street').value,
                    block: document.getElementById('block').value,
                    unitnum: document.getElementById('unitnum').value,
                    postal: document.getElementById('postal').value,
                    // isDefault: document.getElementById('addIsDefault').checked
                };

                console.log(newAddressData);

                $.ajax({
                    url: `/api/addAddress?userId=${userId}`,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(newAddressData),
                    success: function (result) {
                        alert(result.message || 'Address added successfully');
                        modal.style.display = 'none';
                        fetchAddresses();  // Refresh the address list after adding a new address
                    },
                    error: function (error) {
                        console.error('Error adding address:', error);
                    }
                });
            };
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
        }

        // Ensure this function is called when clicking outside the modal content
        window.onclick = function (event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        };

        // window.onclick = function (event) {
        //     const addModal = document.getElementById('addAddressModal');
        //     const editModal = document.getElementById('editAddressModal');
        //     if (event.target === addModal) {
        //         addModal.style.display = 'none';
        //     }
        //     if (event.target === editModal) {
        //         editModal.style.display = 'none';
        //     }
        // };



        // document.addEventListener("DOMContentLoaded", fetchAddresses);

        // function fetchAddresses() {
        //     const userId = `<%#= userId %>`;
        //     const addressList = document.getElementById("addressList");
        //     addressList.innerHTML = 'Loading...';

        //     fetch(`/api/showAddressManagement?userId=${userId}`)
        //         .then(response => response.json())
        //         .then(data => {
        //             addressList.innerHTML = '';
        //             if (data.length === 0) {
        //                 addressList.innerHTML = 'No addresses found.';
        //             } else {
        //                 console.log(data);

        //                 data.forEach((address ,index) => {
        //                     addressList.innerHTML += `
        //                 <div class="info-card">
        //                     <div class="info-header">
        //                         <h5>${address.username || 'Sam'}</h5>
        //                     </div>
        //                     <div class="info-body">
        //                         <p><strong>Phone:</strong> ${address.phone}</p>
        //                         <p><strong>Street:</strong> ${address.street || 'Pathayakunnu'}</p>
        //                         <p><strong>Block/Apartment:</strong> ${address.apartment || 'Sam house'}</p>
        //                         <p><strong>Floor / Unit:</strong> ${address.unit || '0'}</p>
        //                         <p><strong>Postal Code:</strong> ${address.postalCode || '670691'}</p>
        //                     </div>
        //                     <div class="info-action">
        //                         <button class="action-btn" onclick="editAddress('${address._id}')">Edit</button>
        //                         <button class="delete-btn" onclick="deleteAddress('${address._id}')">Delete</button>
        //                     </div>
        //                 </div>
        //             `;
        //                 });
        //             }
        //         })
        //         .catch(error => console.error('Error fetching addresses:', error));
        // }

        // function deleteAddress(addressId) {
        //     if (confirm('Are you sure you want to delete this address?')) {
        //         $.ajax({
        //             url: `/api/deleteAddress?userId=${userId}`,
        //             type: 'DELETE',
        //             data: { addressId: addressId },
        //             success: function (result) {
        //                 // alert(result.message || 'Address deleted successfully');
        //                 fetchAddresses();  // Refresh the address list after deletion
        //             },
        //             error: function (error) {
        //                 console.error('Error deleting address:', error);
        //             }
        //         });
        //     }
        // }

        // function editAddress(id, username, phone, street, apartment, unit, postalCode) {
        //     // Open the modal
        //     const modal = document.getElementById('editAddressModal');
        //     modal.style.display = 'block';

        //     // Populate the form with the current address details
        //     document.getElementById('addressId').value = id;
        //     document.getElementById('editUsername').value = username || '';
        //     document.getElementById('editPhone').value = phone || '';
        //     document.getElementById('editStreet').value = street || '';
        //     document.getElementById('editApartment').value = apartment || '';
        //     document.getElementById('editUnit').value = unit || '';
        //     document.getElementById('editPostalCode').value = postalCode || '';

        //     // Close the modal when the close button is clicked
        //     document.querySelector('.close').onclick = () => {
        //         modal.style.display = 'none';
        //     };

        //     // Handle the form submission for saving changes
        //     document.getElementById('editAddressForm').onsubmit = function (event) {
        //         event.preventDefault();

        //         const addressData = {
        //             username: document.getElementById('editUsername').value,
        //             phone: document.getElementById('editPhone').value,
        //             street: document.getElementById('editStreet').value,
        //             apartment: document.getElementById('editApartment').value,
        //             unit: document.getElementById('editUnit').value,
        //             postalCode: document.getElementById('editPostalCode').value,
        //         };

        //         fetch(`/api/updateAddress?userId=${userId}`, {
        //             method: 'POST',
        //             headers: {
        //                 'Content-Type': 'application/json',
        //             },
        //             body: JSON.stringify(addressData),
        //         })
        //             .then(response => response.json())
        //             .then(data => {
        //                 alert(data.message || 'Address updated successfully');
        //                 modal.style.display = 'none';
        //                 fetchAddresses();  // Refresh the address list
        //             })
        //             .catch(error => console.error('Error updating address:', error));
        //     };
        // }

        // // Close the modal if user clicks outside of it
        // window.onclick = function (event) {
        //     const modal = document.getElementById('editAddressModal');
        //     if (event.target === modal) {
        //         modal.style.display = 'none';
        //     }
        // };

    </script>

    <!-- Removed redundant jQuery script -->
    <!-- <script src='js/jquery.js'></script> -->
    <script src='js/jquery-migrate.min.js'></script>
    <script src='css/bootstrap/js/popper.min.js'></script>
    <script src='css/bootstrap/js/bootstrap.min.js'></script>
    <script src='js/jquery.easing.min.js'></script>
    <script src='js/jquery.fitvids.js'></script>
    <script src='js/owl-carousel/owl.carousel.min.js'></script>
    <script src='js/jquery.magnific-popup.min.js'></script>
    <!-- MAIN JS -->
    <script src='js/init.js'></script>
    <!-- CONTACT FORM JS -->
    <script src='js/jquery.form.min.js'></script>
    <script src='js/contactform-home.js'></script>

</body>

</html>